<!doctype html>
<html lang="my">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dream Pattern 10K</title>

<style>
:root{
  --bg:#070b14; --panel:#101a2a; --text:#e6eefc; --muted:#9db0d4;
  --accent:#34b5ff; --ok:#2dd4bf; --danger:#d34b4b; --warn:#ffb020;
}
*{box-sizing:border-box}
body{
  margin:0; min-height:100vh;
  font-family: system-ui,"Noto Sans Myanmar",sans-serif;
  background:linear-gradient(180deg,#050816,#070b14);
  display:flex; justify-content:center; align-items:center;
  color:var(--text);
}
.app{
  width:420px; max-width:95vw;
  background:#0e1626;
  border-radius:22px;
  box-shadow:0 20px 60px rgba(0,0,0,.5);
  overflow:hidden;
  position:relative; /* overlay anchor */
}
.header{
  padding:20px;
  background:#0f1c33;
}
.header h1{ margin:0; color:var(--accent); font-size:26px; }
.header p{ margin:6px 0 0; font-size:13px; color:var(--muted); }
.content{ padding:18px; }

.row{ display:flex; justify-content:space-between; margin-bottom:10px; }
.count{
  background:#1a2640; padding:6px 12px; border-radius:999px;
  font-size:13px; font-weight:700;
}

.meta{
  display:flex; gap:8px; flex-wrap:wrap;
  margin:10px 0 14px;
}
.pill{
  background:#1a2640; padding:6px 10px; border-radius:999px;
  font-size:12px; font-weight:900; color:#fff;
}
.pill.ok{ color:var(--ok); }
.pill.warn{ color:var(--warn); }
.smallbtn{ height:46px; font-size:13px; border-radius:14px; border:none; }
.smallbtn:active{ transform:scale(.98) }
.resetbtn{ background:var(--danger); color:#fff; }

.slots{
  display:grid; grid-template-columns:repeat(10,1fr);
  gap:6px; margin-bottom:14px;
}
.slot{
  height:40px; border-radius:10px;
  background:#1a2640;
  display:flex; align-items:center; justify-content:center;
  font-weight:800;
}
.slot.empty{ opacity:.3 }

.result{
  background:#121f36;
  border-radius:16px;
  padding:14px;
  margin-bottom:14px;
}
.result h3{ margin:0 0 6px; font-size:14px }
.answer{ display:flex; justify-content:space-between; align-items:center; margin-top:8px; }
.answer span{ font-size:18px; font-weight:900; }
.bar{
  height:10px; border-radius:999px;
  background:#0a1222; overflow:hidden; margin-top:8px;
}
.fill{
  height:100%; width:0%;
  background:linear-gradient(90deg,var(--accent),var(--ok));
  transition:.3s;
}

.keypad{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
button{
  height:54px; border:none; border-radius:16px;
  background:#1a2640; color:#fff;
  font-size:20px; font-weight:800;
}
button:active{ transform:scale(.97) }
.clear{ background:var(--danger); font-size:14px }
.undo{ background:#23345a; font-size:14px }

/* password */
.overlay{
  position:absolute; inset:0;
  background:rgba(0,0,0,.85);
  display:flex; align-items:center; justify-content:center;
}
.card{
  background:#101a2a; padding:20px; border-radius:18px;
  width:90%; max-width:360px;
}
.card input{
  width:100%; padding:12px;
  border-radius:12px; border:none;
  background:#1a2640; color:#fff;
}
.card button{ width:100%; margin-top:10px }
.msg{ margin-top:8px; font-size:12px; color:#ff6b6b }
.oktxt{ color:#2dd4bf }
</style>
</head>

<body>
<div class="app">

  <div class="header">
    <h1>DREAM PATTERN 10K</h1>
    <p>Auto Learn (EXACT10 + PARTIAL6) + Mode Display</p>
  </div>

  <div class="content">
    <div class="row">
      <div>LAST INPUT 10 DIGITS</div>
      <div class="count" id="count">0/10</div>
    </div>

    <div class="meta">
      <div class="pill" id="modePill">MODE: —</div>
      <div class="pill ok">SAMPLES: <span id="samples">0</span></div>
      <div class="pill warn">P10: <span id="p10">0</span></div>
      <div class="pill warn">P6: <span id="p6">0</span></div>
      <button class="smallbtn resetbtn" id="resetDataBtn" type="button">RESET DATA</button>
    </div>

    <div class="slots" id="slots"></div>

    <div class="result">
      <h3>RESULT (EXACT10 → PARTIAL6 → MAJORITY)</h3>
      <div class="answer">
        <span id="label">—</span>
        <span id="percent">—</span>
      </div>
      <div class="bar"><div class="fill" id="fill"></div></div>
    </div>

    <div class="keypad" id="keypad"></div>
  </div>

  <!-- PASSWORD -->
  <div class="overlay" id="overlay">
    <div class="card">
      <input type="password" id="pw" placeholder="Password">
      <button onclick="login()">LOGIN</button>
      <div class="msg" id="msg"></div>
    </div>
  </div>

</div>

<script>
/** =========================
 * CONFIG
 * ========================= */
const PASSWORD="2026CKLOTTERYHACKNEW";

// thresholds to reduce noise
const THRESH_EXACT10 = 3;   // exact10 needs at least 3 samples
const THRESH_PARTIAL6 = 10; // partial6 needs at least 10 samples

// localStorage keys
const LS_DIGITS = "dp10k_digits_v2";
const LS_MAP10  = "dp10k_map10_v2";
const LS_MAP6   = "dp10k_map6_v2";
const LS_META   = "dp10k_meta_v2";

/**
 * map entry:
 * { big: number, small: number, total: number }
 */
let digits = [];
let map10 = {};
let map6  = {};
let meta = { samples: 0 };

/** =========================
 * DOM
 * ========================= */
const slots   = document.getElementById("slots");
const count   = document.getElementById("count");
const label   = document.getElementById("label");
const percent = document.getElementById("percent");
const fill    = document.getElementById("fill");

const modePill = document.getElementById("modePill");
const samplesEl = document.getElementById("samples");
const p10El = document.getElementById("p10");
const p6El  = document.getElementById("p6");
const resetDataBtn = document.getElementById("resetDataBtn");

/** =========================
 * Storage helpers
 * ========================= */
function safeParse(json, fallback){
  try { return JSON.parse(json); } catch { return fallback; }
}
function saveAll(){
  localStorage.setItem(LS_DIGITS, JSON.stringify(digits));
  localStorage.setItem(LS_MAP10, JSON.stringify(map10));
  localStorage.setItem(LS_MAP6, JSON.stringify(map6));
  localStorage.setItem(LS_META, JSON.stringify(meta));
}
function loadAll(){
  digits = safeParse(localStorage.getItem(LS_DIGITS), []);
  map10  = safeParse(localStorage.getItem(LS_MAP10), {});
  map6   = safeParse(localStorage.getItem(LS_MAP6), {});
  meta   = safeParse(localStorage.getItem(LS_META), { samples: 0 });

  if(!Array.isArray(digits)) digits = [];
  if(typeof map10 !== "object" || map10 === null) map10 = {};
  if(typeof map6 !== "object"  || map6  === null) map6  = {};
  if(typeof meta !== "object"  || meta  === null) meta = { samples: 0 };
  if(typeof meta.samples !== "number") meta.samples = 0;
}

/** =========================
 * UI
 * ========================= */
function setMode(text, cls){
  modePill.className = "pill" + (cls ? (" " + cls) : "");
  modePill.textContent = "MODE: " + text;
}
function updateMetaUI(){
  samplesEl.textContent = String(meta.samples || 0);
  p10El.textContent = String(Object.keys(map10).length);
  p6El.textContent  = String(Object.keys(map6).length);
}
function render(){
  slots.innerHTML="";
  for(let i=0;i<10;i++){
    let d=document.createElement("div");
    d.className="slot"+(digits[i]==null?" empty":"");
    d.textContent=digits[i] ?? "";
    slots.appendChild(d);
  }
  count.textContent = digits.length + "/10";
  updateMetaUI();
  calc();
}

/** =========================
 * Learning
 * ========================= */
function isBigDigit(d){ return d >= 5; }

function bump(map, key, nextDigit){
  if(!key) return;
  if(!map[key]) map[key] = { big:0, small:0, total:0 };
  if(isBigDigit(nextDigit)) map[key].big += 1;
  else map[key].small += 1;
  map[key].total += 1;
}

function learn(prev10Key, prev6Key, nextDigit){
  bump(map10, prev10Key, nextDigit);
  bump(map6,  prev6Key,  nextDigit);
  meta.samples = (meta.samples || 0) + 1;
}

/** =========================
 * Prediction helpers
 * ========================= */
function predictFromEntry(entry){
  const big = entry.big, small = entry.small, total = entry.total;

  if(big === small){
    return { label:"NO CLEAR", p:50, mode:"TIE", cls:"warn" };
  }
  const isBig = big > small;
  const p = Math.round((Math.max(big, small)/total)*1000)/10;
  return { label: isBig ? "BIG" : "SMALL", p, mode:"LEARNED", cls:"ok" };
}

function calc(){
  if(digits.length < 10){
    label.textContent="—";
    percent.textContent="—";
    fill.style.width="0%";
    setMode("—");
    return;
  }

  const key10 = digits.join("");
  const key6  = digits.slice(-6).join("");

  // 1) EXACT10
  const e10 = map10[key10];
  if(e10 && e10.total >= THRESH_EXACT10){
    const out = predictFromEntry(e10);
    label.textContent = out.label;
    percent.textContent = out.p + "%";
    fill.style.width = out.p + "%";
    setMode("EXACT10 (" + e10.total + ")", out.cls);
    return;
  }

  // 2) PARTIAL6
  const e6 = map6[key6];
  if(e6 && e6.total >= THRESH_PARTIAL6){
    const out = predictFromEntry(e6);
    label.textContent = out.label;
    percent.textContent = out.p + "%";
    fill.style.width = out.p + "%";
    setMode("PARTIAL6 (" + e6.total + ")", out.cls);
    return;
  }

  // 3) MAJORITY fallback on last 10 digits
  let big=0, small=0;
  digits.forEach(d => (d>=5 ? big++ : small++));
  const total = big + small;

  if(big === small){
    label.textContent="NO CLEAR";
    percent.textContent="50%";
    fill.style.width="50%";
    setMode("MAJORITY (TIE)", "warn");
    return;
  }

  const isBig = big > small;
  const p = Math.round((Math.max(big, small)/total)*1000)/10;
  label.textContent = isBig ? "BIG" : "SMALL";
  percent.textContent = p + "%";
  fill.style.width = p + "%";
  setMode("MAJORITY", "");
}

/** =========================
 * Input handlers
 * ========================= */
function add(n){
  // when already at 10, learn (prev10/prev6 -> nextDigit), then shift+push
  if(digits.length === 10){
    const prev10 = digits.join("");
    const prev6  = digits.slice(-6).join("");
    learn(prev10, prev6, n);

    digits.shift();
    digits.push(n);
  }else{
    digits.push(n);
  }

  saveAll();
  render();
}

function clearAll(){
  digits = [];
  saveAll();
  render();
}

function undo(){
  // NOTE: does not rollback learned map (needs action log to rollback properly)
  digits.pop();
  saveAll();
  render();
}

/** =========================
 * Keypad
 * ========================= */
const keypad=document.getElementById("keypad");
[1,2,3,4,5,6,7,8,9].forEach(n=>{
  let b=document.createElement("button");
  b.textContent=n; b.onclick=()=>add(n);
  keypad.appendChild(b);
});
let c=document.createElement("button");
c.textContent="CLEAR"; c.className="clear"; c.onclick=clearAll;
keypad.appendChild(c);

let z=document.createElement("button");
z.textContent="0"; z.onclick=()=>add(0);
keypad.appendChild(z);

let u=document.createElement("button");
u.textContent="UNDO"; u.className="undo"; u.onclick=undo;
keypad.appendChild(u);

/** =========================
 * Reset learned data
 * ========================= */
resetDataBtn.onclick = () => {
  if(confirm("Learned Data (EXACT10/PARTIAL6) အားလုံးဖျက်မလား?")){
    map10 = {};
    map6 = {};
    meta = { samples: 0 };
    saveAll();
    render();
  }
};

/** =========================
 * Login
 * ========================= */
function login(){
  let v=document.getElementById("pw").value;
  let m=document.getElementById("msg");
  if(v===PASSWORD){
    m.textContent="Success"; m.className="msg oktxt";
    document.getElementById("overlay").style.display="none";
  }else{
    m.textContent="Password မမှန်ပါ";
  }
}

/** =========================
 * Boot
 * ========================= */
loadAll();
render();
</script>
</body>
</html>
